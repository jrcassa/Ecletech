<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Venda - Ecletech</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">


    <!-- CSS Centralizado -->
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/venda-form.css">
</head>
<body>
    <div class="toast-container" id="toastContainer"></div>

    <!-- Sidebar -->
    <div id="sidebar-container"></div>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="main-content" id="mainContent">
        <header class="header">
            <div class="header-left">
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 id="pageTitle">Nova Venda</h1>
            </div>
            <div class="header-right">
                <button class="theme-toggle" id="themeToggle" title="Alternar tema">
                    <i class="fas fa-moon"></i>
                </button>
                <a href="vendas.html" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Voltar
                </a>
            </div>
        </header>

        <div class="container">
            <div id="permissionDenied" class="permission-denied" style="display: none;">
                Você não tem permissão para acessar esta página.
            </div>

            <div id="loadingContainer" class="loading-container" style="display: flex;">
                <div class="spinner"></div>
            </div>

            <div id="formContainer" class="card" style="display: none;">
                <div id="errorContainer" style="display: none;">
                    <div class="error-message" id="errorMessage"></div>
                </div>

                <form id="formVenda" novalidate>
                    <input type="hidden" id="vendaId">

                    <!-- Tabs -->
                    <div class="tabs">
                        <button type="button" class="tab-button active" data-tab="geral">
                            <i class="fas fa-info-circle"></i> Informações Gerais
                        </button>
                        <button type="button" class="tab-button" data-tab="itens">
                            <i class="fas fa-shopping-cart"></i> Itens
                        </button>
                        <button type="button" class="tab-button" data-tab="pagamentos">
                            <i class="fas fa-money-bill"></i> Pagamentos
                        </button>
                        <button type="button" class="tab-button" data-tab="endereco">
                            <i class="fas fa-map-marker-alt"></i> Endereço de Entrega
                        </button>
                        <button type="button" class="tab-button" data-tab="observacoes">
                            <i class="fas fa-sticky-note"></i> Observações
                        </button>
                    </div>

                    <!-- Tab: Informações Gerais -->
                    <div class="tab-content active" id="tabGeral">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="dataVenda">Data da Venda *</label>
                                <input type="date" id="dataVenda" required>
                            </div>
                            <div class="form-group">
                                <label for="codigo">Código *</label>
                                <input type="text" id="codigo" required placeholder="Ex: VD001">
                            </div>
                            <div class="form-group">
                                <label for="situacaoVendaId">Situação *</label>
                                <select id="situacaoVendaId" required>
                                    <option value="">Selecione...</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group" style="position: relative;">
                                <label for="clienteNome">Cliente</label>
                                <input type="text" id="clienteNome" placeholder="Digite para buscar..." autocomplete="off">
                                <input type="hidden" id="clienteId">
                                <div id="clienteAutocompleteList" class="autocomplete-list" style="display: none; position: absolute; z-index: 1000; background: var(--card-bg); border: 1px solid var(--border-color); max-height: 200px; overflow-y: auto; width: calc(100% - 24px); border-radius: 6px; box-shadow: 0 4px 12px var(--shadow-color); margin-top: 4px;"></div>
                            </div>
                            <div class="form-group">
                                <label for="vendedorId">Vendedor</label>
                                <select id="vendedorId">
                                    <option value="">Selecione...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="tecnicoId">Técnico</label>
                                <select id="tecnicoId">
                                    <option value="">Selecione...</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="lojaId">Loja</label>
                                <select id="lojaId">
                                    <option value="">Selecione...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="canalVenda">Canal de Venda</label>
                                <input type="text" id="canalVenda" placeholder="Presencial, WhatsApp, Site...">
                            </div>
                            <div class="form-group">
                                <label for="prazoEntrega">Prazo de Entrega</label>
                                <input type="date" id="prazoEntrega">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="valorFrete">Valor do Frete</label>
                                <input type="number" id="valorFrete" step="0.01" value="0.00">
                            </div>
                            <div class="form-group">
                                <label for="descontoValor">Desconto (R$)</label>
                                <input type="number" id="descontoValor" step="0.01" value="0.00">
                            </div>
                            <div class="form-group">
                                <label for="ativo">Status</label>
                                <select id="ativo">
                                    <option value="1">Ativo</option>
                                    <option value="0">Inativo</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Tab: Itens -->
                    <div class="tab-content" id="tabItens">
                        <div class="dynamic-list">
                            <div class="dynamic-list-header">
                                <h4>Itens da Venda</h4>
                                <button type="button" class="btn btn-success btn-small" id="btnAddItem">
                                    <i class="fas fa-plus"></i> Adicionar Item
                                </button>
                            </div>
                            <div class="dynamic-list-items" id="listaItens">
                                <p style="text-align: center; color: var(--text-secondary);">Nenhum item adicionado</p>
                            </div>
                        </div>

                        <div class="total-box">
                            <h4>Total dos Itens</h4>
                            <div class="valor" id="totalItens">R$ 0,00</div>
                        </div>
                    </div>

                    <!-- Tab: Pagamentos -->
                    <div class="tab-content" id="tabPagamentos">
                        <div class="form-group" style="margin-bottom: 25px;">
                            <label style="display: block; margin-bottom: 10px;">Tipo de Pagamento *</label>
                            <div style="display: flex; gap: 20px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: normal;">
                                    <input type="radio" name="tipoPagamento" id="tipoPagamentoAvista" value="avista" checked>
                                    <span>À Vista</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: normal;">
                                    <input type="radio" name="tipoPagamento" id="tipoPagamentoParcelado" value="parcelado">
                                    <span>Parcelado</span>
                                </label>
                            </div>
                        </div>

                        <div class="dynamic-list">
                            <div class="dynamic-list-header">
                                <h4>Parcelas de Pagamento</h4>
                                <button type="button" class="btn btn-success btn-small" id="btnAddPagamento" style="display: none;">
                                    <i class="fas fa-plus"></i> Adicionar Parcela
                                </button>
                            </div>
                            <div class="dynamic-list-items" id="listaPagamentos">
                                <p style="text-align: center; color: var(--text-secondary);">Nenhum pagamento adicionado</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tab: Endereço -->
                    <div class="tab-content" id="tabEndereco">
                        <div class="form-group" style="margin-bottom: 25px;">
                            <label style="display: block; margin-bottom: 10px;">Tipo de Entrega *</label>
                            <div style="display: flex; gap: 20px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: normal;">
                                    <input type="radio" name="tipoEntrega" id="tipoEntregaRetirar" value="retirar" checked>
                                    <span>Retirar na Loja</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: normal;">
                                    <input type="radio" name="tipoEntrega" id="tipoEntregaEntregar" value="entrega">
                                    <span>Entrega</span>
                                </label>
                            </div>
                        </div>

                        <div id="enderecoContainer" style="display: none;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="enderecoCep">CEP</label>
                                    <input type="text" id="enderecoCep" placeholder="00000-000">
                                </div>
                                <div class="form-group">
                                    <label for="enderecoLogradouro">Logradouro</label>
                                    <input type="text" id="enderecoLogradouro">
                                </div>
                                <div class="form-group">
                                    <label for="enderecoNumero">Número</label>
                                    <input type="text" id="enderecoNumero">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="enderecoComplemento">Complemento</label>
                                    <input type="text" id="enderecoComplemento">
                                </div>
                                <div class="form-group">
                                    <label for="enderecoBairro">Bairro</label>
                                    <input type="text" id="enderecoBairro">
                                </div>
                                <div class="form-group">
                                    <label for="enderecoCidadeId">Cidade</label>
                                    <select id="enderecoCidadeId">
                                        <option value="">Selecione...</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab: Observações -->
                    <div class="tab-content" id="tabObservacoes">
                        <div class="form-group">
                            <label for="introducao">Introdução</label>
                            <textarea id="introducao" rows="3"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="observacoes">Observações (para o cliente)</label>
                            <textarea id="observacoes" rows="4"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="observacoesInterna">Observações Internas</label>
                            <textarea id="observacoesInterna" rows="4"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="aosCuidadosDe">Aos Cuidados De</label>
                            <input type="text" id="aosCuidadosDe">
                        </div>
                    </div>

                    <div class="form-actions">
                        <a href="vendas.html" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Salvar Venda
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="js/API.js"></script>
    <script src="js/Auth.js"></script>
    <script src="js/Utils.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/sidebar.js"></script>
    <script>
        // Sistema de tema claro/escuro
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = themeToggle.querySelector('i');
        const htmlElement = document.documentElement;

        // Carregar tema salvo do localStorage
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                htmlElement.setAttribute('data-theme', 'dark');
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            } else {
                htmlElement.setAttribute('data-theme', 'light');
                themeIcon.classList.remove('fa-sun');
                themeIcon.classList.add('fa-moon');
            }
        }

        // Alternar tema
        function toggleTheme() {
            const currentTheme = htmlElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';

            htmlElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);

            if (newTheme === 'dark') {
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            } else {
                themeIcon.classList.remove('fa-sun');
                themeIcon.classList.add('fa-moon');
            }
        }

        // Event listener para o botão de tema
        themeToggle.addEventListener('click', toggleTheme);

        // Carregar tema ao iniciar
        loadTheme();

        // Sistema de abas
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', function () {
                const tabName = this.getAttribute('data-tab');

                // Remove active de todas as abas e conteúdos
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                // Adiciona active na aba e conteúdo clicados
                this.classList.add('active');
                const tabId = 'tab' + tabName.charAt(0).toUpperCase() + tabName.slice(1);
                const tabContent = document.getElementById(tabId);
                if (tabContent) {
                    tabContent.classList.add('active');
                }
            });
        });

        // Menu Toggle (sidebar)
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const menuToggle = document.getElementById('menuToggle');
        const mainContent = document.getElementById('mainContent');

        function toggleSidebar() {
            const isMobile = window.innerWidth <= 768;

            if (isMobile) {
                if (sidebar) sidebar.classList.toggle('open');
                if (sidebarOverlay) sidebarOverlay.classList.toggle('show');
            } else {
                if (sidebar) sidebar.classList.toggle('closed');
                if (mainContent) mainContent.classList.toggle('expanded');
            }
        }

        if (menuToggle) {
            menuToggle.addEventListener('click', toggleSidebar);
        }

        if (sidebarOverlay) {
            sidebarOverlay.addEventListener('click', toggleSidebar);
        }

        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                if (sidebar) sidebar.classList.remove('open');
                if (sidebarOverlay) sidebarOverlay.classList.remove('show');
            }
        });
    </script>
    <script src="js/venda-form.js"></script>
</body>
</html>
